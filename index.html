<!--
  Don't use the "5-unsafe" CDN version in your own code. It will break on you. 
  Instead go to videojs.com and copy the CDN urls for the latest version.
-->

<head>
  <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- If you'd like to support IE8 (for Video.js versions prior to v7) -->
  <!-- <script src="https://vjs.zencdn.net/ie8/1.1.2/videojs-ie8.min.js"></script> -->
<style>
  body {
      background: #091F2F;
      text-align: center;
      color: #E0E0E0;
      height: 93%;
      margin: 0;
      padding: 2em;
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  }

  #video-container {
            height: 100%;
        }

        .video-js {
            height: 100% !important;
            width: 100% !important;
        }

</style>
</head>

<div id="video-container">
  <video id="my_video_1" class="video-js vjs-default-skin" autoplay muted controls preload="auto" loop></video>
</div>

<script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const videoContainer = 'my_video_1'
        const repoOwner = 'CityOfBoston';
        const repoName = 'doit-welcome-board';
        const winFolderPath = 'wins';
        const transitionFolderPath = 'transitions'
        let winVideoSources = [];
        let transitionVideoSources = [];
        let isWinVideoNext = true;

        function fetchVideoFiles(folderPath, videoSourcesArray, callback) {
        fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}`)
          .then(response => response.json())
          .then(data => {
            // TODO: These videos need to be mp4 or webm videos, either export in these formats or change this line
            const videoFiles = data.filter(file => file.type === 'file' && (file.name.endsWith('.mp4') || file.name.endsWith('.webm')));

            videoFiles.forEach(file => {
              const source = {
                src: file.download_url,
                type: `video/${file.name.split('.').pop()}`
              };
              videoSourcesArray.push(source);
            });

            callback();
          })
          .catch(error => {
            console.error(`Error fetching video files from ${folderPath}:`, error);
            callback();
          });
      }

      // Fetch videos from both folders
      fetchVideoFiles(winFolderPath, winVideoSources, () => {
        fetchVideoFiles(transitionFolderPath, transitionVideoSources, playNextVideo);
      });

      function playNextVideo() {
        let videoSources;
        if (isWinVideoNext) {
          videoSources = winVideoSources;
        } else {
          videoSources = transitionVideoSources;
        }

        if (videoSources.length === 0) {
          console.error('No video sources available.');
          return;
        }

        const randomIndex = Math.floor(Math.random() * videoSources.length);
        const videoSource = videoSources[randomIndex];

        const player = videojs(videoContainer, { controls: false, autoplay: true, muted: true, loop: false, inactivityTimeout: 0 });
        player.src({ src: videoSource.src, type: videoSource.type });
        player.play();

        player.one('ended', function() {
          isWinVideoNext = !isWinVideoNext;
          playNextVideo();
        });
      }
    });

</script>
</body>
</html>
